<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Emitter 0.1a</title>
</head>
<script src='js/dat.gui.js'></script>

<script src="js/three.js"></script>
<script src="js/Mirror.js"></script>
<script src="js/WaterShaderNoSimplex.js"></script>
<script src="js/orbit.js"></script>
<script src="js/util.js"></script>
<script src="js/SimplexNoise.js"></script>
<script src="js/GPUComputationRenderer.js"></script>
<script src="js/STLLoader.js"></script>
<script id="smoothFragmentShader" type="x-shader/x-fragment">
			uniform sampler2D texture;
			void main()	{
				vec2 cellSize = 1.0 / resolution.xy;
				vec2 uv = gl_FragCoord.xy * cellSize;
				// Computes the mean of texel and 4 neighbours
				vec4 textureValue = texture2D( texture, uv );
				textureValue += texture2D( texture, uv + vec2( 0.0, cellSize.y ) );
				textureValue += texture2D( texture, uv + vec2( 0.0, - cellSize.y ) );
				textureValue += texture2D( texture, uv + vec2( cellSize.x, 0.0 ) );
				textureValue += texture2D( texture, uv + vec2( - cellSize.x, 0.0 ) );
				textureValue /= 5.0;
				gl_FragColor = textureValue;
			}
</script>
<script id="heightmapFragmentShader" type="x-shader/x-fragment">
			#include <common>
			uniform vec2 mousePos;
			uniform float rippleSize;
			uniform float viscosityConstant;
            float noise = 10.0;
			#define deltaTime ( 1.0 / 60.0 )
			#define GRAVITY_CONSTANT ( resolution.x * deltaTime * 10.0 )
			void main()	{
				vec2 cellSize = 1.0 / resolution.xy;
				vec2 uv = gl_FragCoord.xy * cellSize;
				vec4 heightmapValue = texture2D( heightmap, uv );
				vec4 north = texture2D( heightmap, uv + vec2( 0.0, cellSize.y ) );
				vec4 south = texture2D( heightmap, uv + vec2( 0.0, - cellSize.y ) );
				vec4 east = texture2D( heightmap, uv + vec2( cellSize.x, 0.0 ) );
				vec4 west = texture2D( heightmap, uv + vec2( - cellSize.x, 0.0 ) );
				float sump = north.x + south.x + east.x + west.x - 4.0 * heightmapValue.x;
				float accel = sump * GRAVITY_CONSTANT;
				heightmapValue.y += accel;
				heightmapValue.x += heightmapValue.y * deltaTime;
				heightmapValue.x += sump * viscosityConstant;
				// Mouse influence
				float mousePhase = clamp( length( ( uv - vec2( 0.5 ) ) * BOUNDS - vec2( mousePos.x, - mousePos.y ) ) * PI / rippleSize, 0.0, PI );
				heightmapValue.x += noise*cos( mousePhase ) + noise;
				gl_FragColor = heightmapValue;
			}
</script>
<script src="js/render.js"></script>
<script src="js/skyBox.js"></script>
<script src="js/init.js"></script>
<script src="js/water.js"></script>
<script src="js/manneken.js"></script>
<script src="js/emitter.js"></script>
<script src="js/GUI.js"></script>

<style>
    * {
        margin:0;
    }
</style>
<body onload="start()">
</body>
</html>